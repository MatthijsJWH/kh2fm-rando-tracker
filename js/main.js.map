{"version":3,"sources":["../../js/main.js"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["ï»¿function handlePrimary(event, offset = 1) {\r\n  const elem = event.currentTarget;\r\n  if (elem.classList.contains(\"disabled\"))\r\n    // If the world/item is disabled, don't do anything\r\n    return;\r\n\r\n  const parentElem = elem.parentElement;\r\n  const elemIndex = Array.prototype.indexOf.call(parentElem.children, elem);\r\n  if (socket && !parentElem.dataset.userId)\r\n    socket.send(JSON.stringify({\r\n      type: \"user_primary\",\r\n      item: elemIndex,\r\n      offset: offset,\r\n    }));\r\n\r\n  const nobody = $(\".nobody\", elem);\r\n\r\n  const total = Number(elem.dataset.total ?? 1) + Boolean(nobody);\r\n  const end = total + 1;\r\n\r\n  // Change level, resetting to 0 if >total, or wrapping to the end if <0\r\n  let level = Number(elem.dataset.level ?? 0)\r\n  if (level === 0 || $(\".icon\", elem).classList.contains(\"opaque\"))\r\n    // When in group, don't increase level if item unlocked for first time but already levelled\r\n    level = (level + (end + offset) % end) % end;\r\n\r\n  elem.dataset.level = level;\r\n\r\n  if (nobody && level === total)\r\n    // Show nobody symbol on last level\r\n    nobody.classList.add(\"opaque\");\r\n\r\n  const imgNum = Math.min(level, total - Boolean(nobody))\r\n\r\n  const group = elem.dataset.group;\r\n  const elems = group ? $$(`[data-group=\"${group}\"]`, elem.parent) : [ elem ];\r\n\r\n  elems.forEach((groupElem) => {\r\n    // Change state for each item in group\r\n    groupElem.dataset.level = level;\r\n\r\n    let icon = $(\".icon\", groupElem);\r\n    const number = $(\".number\", groupElem);\r\n    const nobody = $(\".nobody\", groupElem);\r\n\r\n    icon = elem === groupElem ? icon : null;\r\n\r\n    if (imgNum > 1)\r\n      number?.setAttribute(\"src\", `img/numbers/${imgNum}.png`);\r\n\r\n    switch (level) {\r\n      case 0:\r\n        // Disable\r\n        icon?.classList.remove(\"opaque\");\r\n        number?.classList.remove(\"opaque\");\r\n        nobody?.classList.remove(\"opaque\");\r\n        break;\r\n\r\n      case 1:\r\n        // First state, don't show number yet\r\n        icon?.classList.add(\"opaque\");\r\n        number?.classList.remove(\"opaque\");\r\n        break;\r\n\r\n      default:\r\n        icon?.classList.add(\"opaque\");\r\n        number?.classList.add(\"opaque\");\r\n        break;\r\n    }\r\n  })\r\n}\r\n\r\nfunction handleSecondary(event) {\r\n  const elem = event.currentTarget;\r\n  if (elem.classList.contains(\"disabled\"))\r\n    return;\r\n\r\n  const secondary = $(\".secondary\", elem);\r\n  if (!secondary)\r\n    return;\r\n\r\n  const parentElem = elem.parentElement;\r\n  const elemIndex = Array.prototype.indexOf.call(parentElem.children, elem);\r\n  if (socket && !parentElem.dataset.userId)\r\n    socket.send(JSON.stringify({\r\n      type: \"user_secondary\",\r\n      item: elemIndex,\r\n    }));\r\n\r\n  let files = secondary.dataset.files;\r\n  if (!files)\r\n    // A single image rather than an array\r\n    return secondary.classList.toggle(\"opaque\");\r\n\r\n  // Otherwise, parse JSON array\r\n  files = JSON.parse(secondary.dataset.files);\r\n\r\n  // Increment image index\r\n  let index = Number(secondary.dataset.index ?? 0) + 1;\r\n  if (index % (files.length + 1) === 0)\r\n    index = 0;\r\n  else\r\n    secondary.setAttribute(\"src\", `img/secondary/${files[index - 1]}.png`);\r\n\r\n  // We toggle the opaque class for 0 (disable) and 1 (enable)\r\n  if (index < 2)\r\n    secondary.classList.toggle(\"opaque\");\r\n\r\n  secondary.dataset.index = index;\r\n}\r\n\r\nfunction handleDisable(event) {\r\n  const elem = event.currentTarget;\r\n\r\n  const parentElem = elem.parentElement;\r\n  const elemIndex = Array.prototype.indexOf.call(parentElem.children, elem);\r\n  if (socket && !parentElem.dataset.userId)\r\n    socket.send(JSON.stringify({\r\n      type: \"user_secondary\",\r\n      item: elemIndex,\r\n    }));\r\n\r\n  elem.classList.toggle('disabled');\r\n}\r\n\r\n// Item clicking\r\n$$(\".grid > div\").forEach((elem) => {\r\n  elem.onmousedown = (event) => {\r\n    switch (event.button) {\r\n      case 0:\r\n        // Left click\r\n        handlePrimary(event);\r\n        break;\r\n\r\n      case 2:\r\n        // Right click\r\n        handleSecondary(event);\r\n        break;\r\n\r\n      case 1:\r\n        // Middle click\r\n        handleDisable(event);\r\n        break;\r\n    }\r\n  };\r\n\r\n  // We have our own events for right click so the context menu would be intrusive\r\n  elem.oncontextmenu = (event) => event.preventDefault();\r\n\r\n  // Scroll to increment/decrement\r\n  elem.onwheel = (event) => {\r\n    // Check setting is on\r\n    if (!scrollElem.checked)\r\n      return;\r\n\r\n    // Prevent page scroll\r\n    event.preventDefault();\r\n\r\n    // Increment/decrement\r\n    const offset = event.deltaY < 0 ? 1 : -1;\r\n    handlePrimary(event, offset);\r\n  }\r\n});\r\n\r\ndocument.body.onmousedown = (event) => {\r\n  if (event.button === 1)\r\n    // Prevent autoscroll on middle click\r\n    return false;\r\n}\r\n"]}