{"version":3,"sources":["../../js/main.js"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["ï»¿function handlePrimary(event, offset = 1) {\r\n  const elem = event.currentTarget;\r\n  if (elem.classList.contains(\"disabled\"))\r\n    // If the world/item is disabled, don't do anything\r\n    return;\r\n\r\n  // Dispatch event to the other clients in co-op room\r\n  const parentElem = elem.parentElement;\r\n  if (socket && !parentElem.dataset.userId) {\r\n    const elemIndex = Array.prototype.indexOf.call(parentElem.children, elem);\r\n    socket.send(JSON.stringify({\r\n      type: \"user_primary\",\r\n      item: elemIndex,\r\n      offset: offset,\r\n    }));\r\n  }\r\n\r\n  const nobody = $(\".nobody\", elem);\r\n\r\n  const total = Number(elem.dataset.total ?? 1) + Boolean(nobody);\r\n  const end = total + 1;\r\n\r\n  // Change level, resetting to 0 if >total, or wrapping to the end if <0\r\n  let level = Number(elem.dataset.level ?? 0)\r\n  if (level === 0 || $(\".icon\", elem).classList.contains(\"opaque\"))\r\n    // When in group, don't increase level if item unlocked for first time but already levelled\r\n    level = (level + (end + offset) % end) % end;\r\n\r\n  elem.dataset.level = level;\r\n\r\n  if (nobody && level === total)\r\n    // Show nobody symbol on last level\r\n    nobody.classList.add(\"opaque\");\r\n\r\n  const imgNum = Math.min(level, total - Boolean(nobody))\r\n\r\n  const group = elem.dataset.group;\r\n  const elems = group ? $$(`[data-group=\"${group}\"]`, elem.parent) : [ elem ];\r\n\r\n  elems.forEach(groupElem => {\r\n    // Change state for each item in group\r\n    groupElem.dataset.level = level;\r\n\r\n    const icon = elem === groupElem ? $(\".icon\", groupElem) : null;\r\n    const number = $(\".number\", groupElem);\r\n    const nobody = $(\".nobody\", groupElem);\r\n\r\n    if (imgNum > 1)\r\n      number?.setAttribute(\"src\", `img/numbers/${imgNum}.png`);\r\n\r\n    switch (level) {\r\n      case 0:\r\n        // Disable\r\n        icon?.classList.remove(\"opaque\");\r\n        number?.classList.remove(\"opaque\");\r\n        nobody?.classList.remove(\"opaque\");\r\n        break;\r\n\r\n      case 1:\r\n        // First state, don't show number yet\r\n        icon?.classList.add(\"opaque\");\r\n        number?.classList.remove(\"opaque\");\r\n        break;\r\n\r\n      default:\r\n        icon?.classList.add(\"opaque\");\r\n        number?.classList.add(\"opaque\");\r\n        break;\r\n    }\r\n  });\r\n}\r\n\r\nfunction handleSecondary(event) {\r\n  const elem = event.currentTarget;\r\n  if (elem.classList.contains(\"disabled\"))\r\n    return;\r\n\r\n  const secondary = $(\".secondary\", elem);\r\n  if (!secondary)\r\n    return;\r\n\r\n  // Dispatch event to the other clients in co-op room\r\n  const parentElem = elem.parentElement;\r\n  if (socket && !parentElem.dataset.userId) {\r\n    const elemIndex = Array.prototype.indexOf.call(parentElem.children, elem);\r\n    socket.send(JSON.stringify({\r\n      type: \"user_secondary\",\r\n      item: elemIndex,\r\n    }));\r\n  }\r\n\r\n  let files = secondary.dataset.files;\r\n  if (!files)\r\n    // A single image rather than an array\r\n    return secondary.classList.toggle(\"opaque\");\r\n\r\n  // Otherwise, parse JSON array\r\n  files = JSON.parse(secondary.dataset.files);\r\n\r\n  // Increment image index\r\n  let index = Number(secondary.dataset.index ?? 0) + 1;\r\n  if (index % (files.length + 1) === 0)\r\n    index = 0;\r\n  else\r\n    secondary.setAttribute(\"src\", `img/secondary/${files[index - 1]}.png`);\r\n\r\n  // We toggle the opaque class for 0 (disable) and 1 (enable)\r\n  if (index < 2)\r\n    secondary.classList.toggle(\"opaque\");\r\n\r\n  secondary.dataset.index = index;\r\n}\r\n\r\nfunction handleDisable(event) {\r\n  const elem = event.currentTarget;\r\n\r\n  const parentElem = elem.parentElement;\r\n  if (socket && !parentElem.dataset.userId) {\r\n    const elemIndex = Array.prototype.indexOf.call(parentElem.children, elem);\r\n    socket.send(JSON.stringify({\r\n      type: \"user_secondary\",\r\n      item: elemIndex,\r\n    }));\r\n  }\r\n\r\n  elem.classList.toggle('disabled');\r\n}\r\n\r\n// Item clicking\r\n$$(\".grid > div\").forEach(elem => {\r\n  elem.onmousedown = event => {\r\n    switch (event.button) {\r\n      case 0:\r\n        // Left click\r\n        handlePrimary(event);\r\n        break;\r\n\r\n      case 2:\r\n        // Right click\r\n        handleSecondary(event);\r\n        break;\r\n\r\n      case 1:\r\n        // Middle click\r\n        handleDisable(event);\r\n        break;\r\n    }\r\n  };\r\n\r\n  // We have our own events for right click so the context menu would be intrusive\r\n  elem.oncontextmenu = event => event.preventDefault();\r\n\r\n  // Scroll to increment/decrement\r\n  elem.onwheel = event => {\r\n    // Check setting is on\r\n    if (!scrollElem.checked)\r\n      return;\r\n\r\n    // Prevent page scroll\r\n    event.preventDefault();\r\n\r\n    // Increment/decrement\r\n    const offset = event.deltaY < 0 ? 1 : -1;\r\n    handlePrimary(event, offset);\r\n  }\r\n});\r\n\r\ndocument.body.onmousedown = event => {\r\n  if (event.button === 1)\r\n    // Prevent autoscroll on middle click\r\n    return false;\r\n}\r\n"]}